# wasm-audio - Rustオーディオ処理モジュール

このディレクトリにはWebAssemblyにコンパイルされるRustオーディオ処理コードが含まれています。

## モジュール構成

コードは単一責任の原則に従って以下のモジュールに分割されています：

### `filter.rs`
**責任**: Biquad IIRフィルタの実装

- `BiquadFilter` 構造体とその実装
- RBJ Audio EQ Cookbookの数式に基づくフィルタ係数計算
- サポートするフィルタタイプ:
  - LPF (ローパスフィルタ)
  - HPF (ハイパスフィルタ)
  - BPF (バンドパスフィルタ)
  - Notch (ノッチフィルタ)
  - APF (オールパスフィルタ)
  - Low Shelf (ローシェルフフィルタ)
  - High Shelf (ハイシェルフフィルタ)
- フィルタ状態管理とサンプル処理

### `oscillator.rs`
**責任**: 波形生成

- `generate_sawtooth()` - ノコギリ波生成
- `generate_pulse()` - パルス波生成（可変デューティ比）
- 純粋関数による実装

### `audio_renderer.rs`
**責任**: オーディオレンダリングの統合・調整

- `render_audio()` - メインレンダリング関数
- 波形生成とフィルタ処理の統合
- カットオフ周波数の時間的減衰処理（HzまたはCent単位）
- フィルタ係数の効率的な更新（約1ms毎）

### `lib.rs`
**責任**: モジュール宣言とパブリックAPI

- モジュール宣言
- WASM bindingsのためのパブリックAPI再エクスポート
- 外部からアクセス可能な関数・構造体の定義

## テスト

各モジュールは独自のテストスイートを持ち、`#[cfg(test)]`モジュールとして実装されています：

- **filter.rs**: 6テスト - フィルタ動作と安定性の検証
- **oscillator.rs**: 3テスト - 波形生成とパラメータ処理の検証
- **audio_renderer.rs**: 8テスト - 統合レンダリングと各フィルタタイプの検証

テスト実行:
```bash
cargo test
```

## ビルド

WASM向けにビルド:
```bash
wasm-pack build --target web --release
```

または、プロジェクトルートから:
```bash
npm run build:wasm
```

## 設計原則

このリファクタリングは以下の原則に従っています：

1. **単一責任の原則**: 各モジュールは1つの明確な責任を持つ
2. **テストの局所性**: テストは対応するモジュールと共存
3. **明確な依存関係**: `audio_renderer` → `filter` + `oscillator` → `lib.rs`
4. **変更の最小化**: 既存の機能やAPIは変更なし、構造のみリファクタリング
